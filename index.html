<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>BOSS PANEL ‚Äî Synchronized</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        :root { --red: #ff3b30; --green: #34c759; --blue: #007aff; --bg: #000; --card: #1c1c1e; --text: #fff; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .client-card { background: var(--card); border-radius: 16px; padding: 20px; margin-bottom: 20px; border: 1px solid #333; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 15px; }
        label { display: block; font-size: 11px; color: #8e8e93; margin-bottom: 4px; text-transform: uppercase; }
        input { width: 100%; background: #2c2c2e; border: 1px solid #3d3d3f; color: #fff; padding: 10px; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-save { background: var(--blue); color: #fff; }
        .btn-block { background: transparent; border: 1px solid var(--red); color: var(--red); }
        .btn-unblock { background: transparent; border: 1px solid var(--green); color: var(--green); }
        .report-box { background: #ffd60a; color: #000; padding: 15px; border-radius: 12px; margin-bottom: 20px; position: relative; }
        .del-report { position: absolute; top: 10px; right: 10px; cursor: pointer; font-weight: bold; }
        h1 { color: var(--blue); }
    </style>
</head>
<body>

    <h1>üëë BOSS PANEL (Sync Mode)</h1>
    <div id="reports-list"></div>
    <hr style="border: 0.5px solid #333; margin: 20px 0;">
    <div id="clients-admin">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyA3J7KnUgxUHZigwRKmndm7xyxJeeLCrxg",
            databaseURL: "https://webapp-b7149-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "webapp-b7149",
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 1. –†–∞–ø–æ—Ä—Ç—ã
        db.ref('reports').on('value', snap => {
            const div = document.getElementById('reports-list');
            div.innerHTML = "<h3>üîî –†–∞–ø–æ—Ä—Ç—ã</h3>";
            snap.forEach(child => {
                const r = child.val();
                div.innerHTML += `<div class="report-box">
                    <span class="del-report" onclick="db.ref('reports').child('${child.key}').remove()">‚úï</span>
                    <b>${r.staff}</b>: ${r.desc}<br><small>–ö–ª–∏–µ–Ω—Ç: ${r.client}</small>
                </div>`;
            });
        });

        // 2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏
        db.ref('clients').on('value', snap => {
            const list = document.getElementById('clients-admin');
            list.innerHTML = "<h3>üë• –°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤</h3>";
            
            snap.forEach(child => {
                const c = child.val();
                const id = child.key;
                const card = document.createElement('div');
                card.className = 'client-card';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–º–æ—Ä–æ–∑–∫–∏ (frozen –≤ —Ç–≤–æ–µ–º –±–∞–Ω–∫–µ)
                const isFrozen = c.frozen === true;

                card.innerHTML = `
                    <div style="display:flex; justify-content:space-between;">
                        <b>${c.name || '–ë–µ–∑ –∏–º–µ–Ω–∏'}</b>
                        <span style="color:${isFrozen ? 'red' : 'green'}">${isFrozen ? '–ë–õ–û–ö' : 'OK'}</span>
                    </div>
                    
                    <div class="grid">
                        <div>
                            <label>–ë–∞–ª–∞–Ω—Å (‚ÇΩ)</label>
                            <input type="number" id="bal-${id}" value="${c.balance || 0}">
                        </div>
                        <div>
                            <label>–ë–æ–Ω—É—Å—ã</label>
                            <input type="number" id="bon-${id}" value="${c.bonuses || 0}">
                        </div>
                        <div>
                            <label>üîê –ü–ò–ù-–ö–û–î</label>
                            <input type="text" id="pin-${id}" value="${c.clientPin || ''}" maxlength="4">
                        </div>
                        <div>
                            <label>–¢—Ä–∞—Ç—ã (spentMonth)</label>
                            <input type="number" id="spent-${id}" value="${c.spentMonth || 0}">
                        </div>
                    </div>

                    <button class="btn-save" onclick="saveClient('${id}')">–°–û–•–†–ê–ù–ò–¢–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø</button>
                    
                    <button class="${isFrozen ? 'btn-unblock' : 'btn-block'}" onclick="toggleLock('${id}', ${isFrozen})">
                        ${isFrozen ? '–†–ê–ó–ë–õ–û–ö–ò–†–û–í–ê–¢–¨ –ö–ê–†–¢–£' : '–ó–ê–ë–õ–û–ö–ò–†–û–í–ê–¢–¨ –ö–ê–†–¢–£'}
                    </button>

                    <button style="color:gray; font-size:10px; background:none; border:none; margin-top:15px;" onclick="deleteClient('${id}')">–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
                `;
                list.appendChild(card);
            });
        });

        function saveClient(id) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–æ–≤–Ω–æ —Ç–µ –∫–ª—é—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏—â–µ—Ç —Ç–≤–æ–π –û–Ω–ª–∞–π–Ω –ë–∞–Ω–∫
            const updates = {
                balance: parseFloat(document.getElementById(`bal-${id}`).value) || 0,
                bonuses: parseFloat(document.getElementById(`bon-${id}`).value) || 0,
                clientPin: document.getElementById(`pin-${id}`).value,
                spentMonth: parseFloat(document.getElementById(`spent-${id}`).value) || 0
            };

            db.ref('clients').child(id).update(updates)
                .then(() => alert("‚úÖ –î–∞–Ω–Ω—ã–µ –≤ –±–∞–Ω–∫–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!"))
                .catch(err => alert("–û—à–∏–±–∫–∞: " + err));
        }

        function toggleLock(id, currentStatus) {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º frozen, –∫–∞–∫ –≤ —Ç–≤–æ–µ–º –∫–æ–¥–µ
            db.ref('clients').child(id).update({ frozen: !currentStatus });
        }

        function deleteClient(id) {
            if (confirm("–£–¥–∞–ª–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞?")) db.ref('clients').child(id).remove();
        }
    </script>
</body>
</html>
