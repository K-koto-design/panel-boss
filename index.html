<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOSS PANEL ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–∞–Ω–∫–æ–º</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --red: #ff3b30;
            --green: #34c759;
            --blue: #0077ff;
            --yellow: #ffd60a;
            --bg: #000000;
            --card: #1c1c1e;
            --input-bg: #2c2c2e;
            --text: #ffffff;
            --text-sec: #8e8e93;
        }

        body {
            font-family: -apple-system, system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            padding-bottom: 50px;
        }

        h1 { color: var(--blue); font-size: 28px; margin-bottom: 5px; }
        .subtitle { color: var(--text-sec); margin-bottom: 30px; font-size: 14px; }

        /* –°—Ç–∏–ª–∏ —Ä–∞–ø–æ—Ä—Ç–æ–≤ */
        #reports-list { margin-bottom: 30px; }
        .report-box {
            background: var(--yellow);
            color: #000;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            position: relative;
            animation: fadeIn 0.3s ease;
        }
        .report-box b { display: block; font-size: 16px; }
        .report-box small { opacity: 0.7; }
        .del-report {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.1);
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ */
        .client-card {
            background: var(--card);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }

        .client-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .client-name { font-size: 20px; font-weight: bold; margin: 0; }
        .status-badge {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 6px;
            text-transform: uppercase;
            font-weight: bold;
        }
        .status-ok { background: rgba(52, 199, 89, 0.2); color: var(--green); }
        .status-blocked { background: rgba(255, 59, 48, 0.2); color: var(--red); }

        /* –°–µ—Ç–∫–∞ –ø–æ–ª–µ–π */
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .field-group { margin-bottom: 10px; }
        label { display: block; font-size: 11px; color: var(--text-sec); margin-bottom: 4px; text-transform: uppercase; }
        
        input {
            width: 100%;
            background: var(--input-bg);
            border: 1px solid #3d3d3f;
            color: #fff;
            padding: 10px;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 15px;
        }
        input:focus { border-color: var(--blue); outline: none; }

        /* –ö–Ω–æ–ø–∫–∏ */
        button {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            font-size: 14px;
        }

        .btn-save { background: var(--blue); color: #fff; margin-top: 15px; }
        .btn-block { background: transparent; border: 1px solid var(--text-sec); color: var(--text); margin-top: 10px; }
        .btn-delete { background: transparent; color: var(--red); margin-top: 20px; font-size: 12px; opacity: 0.6; }
        
        button:active { transform: scale(0.98); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <h1>üëë –ü–ê–ù–ï–õ–¨ –í–õ–ê–î–ï–õ–¨–¶–ê</h1>
    <p class="subtitle">–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ –ö–û–¢–û–ë–ê–ù–ö</p>

    <div id="reports-list"></div>

    <hr style="border: 0.5px solid #333; margin: 25px 0;">

    <div id="clients-admin">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>

    <script>
        // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyA3J7KnUgxUHZigwRKmndm7xyxJeeLCrxg",
            databaseURL: "https://webapp-b7149-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "webapp-b7149",
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 1. –ü–û–õ–£–ß–ï–ù–ò–ï –†–ê–ü–û–†–¢–û–í
        db.ref('reports').on('value', snap => {
            const container = document.getElementById('reports-list');
            container.innerHTML = "<h3>üîî –ó–∞–ø—Ä–æ—Å—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h3>";
            if (!snap.exists()) {
                container.innerHTML += "<p style='color:gray; font-size:14px;'>–ù–æ–≤—ã—Ö —Ä–∞–ø–æ—Ä—Ç–æ–≤ –Ω–µ—Ç</p>";
                return;
            }
            
            snap.forEach(child => {
                const r = child.val();
                container.innerHTML += `
                    <div class="report-box">
                        <div class="del-report" onclick="db.ref('reports').child('${child.key}').remove()">‚úï</div>
                        <b>${r.staff}</b>
                        <small>–î–ª—è –∫–ª–∏–µ–Ω—Ç–∞: ${r.client}</small>
                        <p style="margin:8px 0 0 0">üëâ ${r.desc}</p>
                    </div>`;
            });
        });

        // 2. –ü–û–õ–£–ß–ï–ù–ò–ï –ò –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–õ–ò–ï–ù–¢–ê–ú–ò
        db.ref('clients').on('value', snap => {
            const list = document.getElementById('clients-admin');
            list.innerHTML = "<h3>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞–º–∏</h3>";
            
            if (!snap.exists()) {
                list.innerHTML += "<p style='color:gray'>–í –±–∞–∑–µ –ø–æ–∫–∞ –Ω–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤</p>";
                return;
            }

            snap.forEach(child => {
                const c = child.val();
                const id = child.key;
                const card = document.createElement('div');
                card.className = 'client-card';
                
                card.innerHTML = `
                    <div class="client-header">
                        <div>
                            <p class="client-name">${c.name || '–ë–µ–∑ –∏–º–µ–Ω–∏'}</p>
                            <code style="color:gray; font-size:10px;">ID: ${id}</code>
                        </div>
                        <span class="status-badge ${c.blocked ? 'status-blocked' : 'status-ok'}">
                            ${c.blocked ? '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' : '–ê–∫—Ç–∏–≤–µ–Ω'}
                        </span>
                    </div>

                    <div class="grid">
                        <div class="field-group">
                            <label>–ë–∞–ª–∞–Ω—Å (‚ÇΩ)</label>
                            <input type="number" id="bal-${id}" value="${c.balance || 0}">
                        </div>
                        <div class="field-group">
                            <label>–ë–æ–Ω—É—Å—ã</label>
                            <input type="number" id="bon-${id}" value="${c.bonuses || 0}">
                        </div>
                        <div class="field-group">
                            <label>–ö—Ä–µ–¥–∏—Ç–Ω—ã–π –ª–∏–º–∏—Ç</label>
                            <input type="number" id="cred-${id}" value="${c.credit_limit || 0}">
                        </div>
                        <div class="field-group">
                            <label>üîê –ü–ò–ù-–ö–û–î</label>
                            <input type="text" id="pin-${id}" value="${c.pin || ''}" maxlength="4">
                        </div>
                    </div>

                    <div class="field-group">
                        <label>–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                        <input type="text" id="phone-${id}" value="${c.phone || ''}">
                    </div>

                    <button class="btn-save" onclick="saveClient('${id}')">–°–û–•–†–ê–ù–ò–¢–¨ –í–°–Å</button>
                    
                    <button class="btn-block" onclick="toggleBlock('${id}', ${c.blocked})">
                        ${c.blocked ? '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É' : '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É'}
                    </button>

                    <button class="btn-delete" onclick="deleteClient('${id}', '${c.name}')">
                        üóë –£–î–ê–õ–ò–¢–¨ –ö–õ–ò–ï–ù–¢–ê –ù–ê–í–°–ï–ì–î–ê
                    </button>
                `;
                list.appendChild(card);
            });
        });

        // –§–£–ù–ö–¶–ò–Ø –°–û–•–†–ê–ù–ï–ù–ò–Ø
        function saveClient(id) {
            const updates = {
                balance: parseFloat(document.getElementById(`bal-${id}`).value) || 0,
                bonuses: parseFloat(document.getElementById(`bon-${id}`).value) || 0,
                credit_limit: parseFloat(document.getElementById(`cred-${id}`).value) || 0,
                pin: document.getElementById(`pin-${id}`).value,
                phone: document.getElementById(`phone-${id}`).value
            };

            db.ref('clients').child(id).update(updates)
                .then(() => alert("‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã"))
                .catch(err => alert("–û—à–∏–±–∫–∞: " + err));
        }

        // –§–£–ù–ö–¶–ò–Ø –ë–õ–û–ö–ò–†–û–í–ö–ò
        function toggleBlock(id, isBlocked) {
            db.ref('clients').child(id).update({ blocked: !isBlocked });
        }

        // –§–£–ù–ö–¶–ò–Ø –£–î–ê–õ–ï–ù–ò–Ø
        function deleteClient(id, name) {
            if (confirm(`–í—ã —Ç–æ—á–Ω–æ —Ö–æ—Ç–∏—Ç–µ –£–î–ê–õ–ò–¢–¨ –∫–ª–∏–µ–Ω—Ç–∞ ${name}?\n–î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å—Ç–µ—Ä—Ç—ã –Ω–∞–≤—Å–µ–≥–¥–∞!`)) {
                db.ref('clients').child(id).remove();
            }
        }
    </script>
</body>
</html>
