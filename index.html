<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>BOSS PANEL ‚Äî –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—É–ª—å—Ç</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        :root { --red: #ff3b30; --green: #34c759; --blue: #007aff; --bg: #000; --card: #1c1c1e; --text: #fff; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .section-title { color: var(--blue); border-bottom: 1px solid #333; padding-bottom: 10px; margin-top: 40px; }
        .client-card { background: var(--card); border-radius: 16px; padding: 20px; margin-bottom: 20px; border: 1px solid #333; }
        .app-card { background: #2c2c2e; border: 1px solid var(--blue); border-radius: 16px; padding: 15px; margin-bottom: 15px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 15px; }
        label { display: block; font-size: 11px; color: #8e8e93; margin-bottom: 4px; text-transform: uppercase; }
        input { width: 100%; background: #2c2c2e; border: 1px solid #3d3d3f; color: #fff; padding: 10px; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.2s; }
        .btn-save { background: var(--blue); color: #fff; }
        .btn-approve { background: var(--green); color: #000; }
        .btn-block { background: transparent; border: 1px solid var(--red); color: var(--red); }
        .btn-unblock { background: transparent; border: 1px solid var(--green); color: var(--green); }
        .report-box { background: #ffd60a; color: #000; padding: 15px; border-radius: 12px; margin-bottom: 20px; position: relative; }
    </style>
</head>
<body>

    <h1>üëë BOSS PANEL</h1>

    <h2 class="section-title">üì• –ù–æ–≤—ã–µ –∑–∞—è–≤–∫–∏ (${document.getElementById('apps-count')?.innerText || 0})</h2>
    <div id="applications-list">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞—è–≤–æ–∫...</div>

    <h2 class="section-title">üîî –†–∞–ø–æ—Ä—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h2>
    <div id="reports-list"></div>

    <h2 class="section-title">üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞–º–∏</h2>
    <div id="clients-admin">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤...</div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyA3J7KnUgxUHZigwRKmndm7xyxJeeLCrxg",
            databaseURL: "https://webapp-b7149-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "webapp-b7149",
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- –õ–û–ì–ò–ö–ê –ó–ê–Ø–í–û–ö ---
        db.ref('applications').on('value', snap => {
            const div = document.getElementById('applications-list');
            div.innerHTML = "";
            if (!snap.exists()) div.innerHTML = "<p style='color:gray'>–ù–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫ –Ω–µ—Ç</p>";
            
            snap.forEach(child => {
                const a = child.val();
                const id = child.key;
                div.innerHTML += `
                    <div class="app-card">
                        <div style="display:flex; justify-content:space-between">
                            <b>${a.name}</b>
                            <span style="color:var(--blue)">${a.orgType}</span>
                        </div>
                        <div style="font-size:13px; margin: 10px 0;">
                            üìû –¢–µ–ª: ${a.phone} <br>
                            üîê –ü–ò–ù: ${a.clientPin}
                        </div>
                        <div style="display:flex; gap:10px">
                            <button class="btn-approve" onclick="approveUser('${id}')">–û–î–û–ë–†–ò–¢–¨</button>
                            <button style="background:#ff3b30; color:#fff" onclick="db.ref('applications').child('${id}').remove()">–û–¢–ö–õ–û–ù–ò–¢–¨</button>
                        </div>
                    </div>`;
            });
        });

        function approveUser(appId) {
            db.ref('applications').child(appId).once('value', snap => {
                const userData = snap.val();
                if (userData) {
                    // –ü–µ—Ä–µ–Ω–æ—Å–∏–º –≤ –æ—Å–Ω–æ–≤–Ω—É—é –±–∞–∑—É –∫–ª–∏–µ–Ω—Ç–æ–≤
                    db.ref('clients').push(userData).then(() => {
                        // –£–¥–∞–ª—è–µ–º –∏–∑ –∑–∞—è–≤–æ–∫
                        db.ref('applications').child(appId).remove();
                        alert("–ö–ª–∏–µ–Ω—Ç " + userData.name + " —É—Å–ø–µ—à–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!");
                    });
                }
            });
        }

        // --- –õ–û–ì–ò–ö–ê –ö–õ–ò–ï–ù–¢–û–í ---
        db.ref('clients').on('value', snap => {
            const list = document.getElementById('clients-admin');
            list.innerHTML = "";
            snap.forEach(child => {
                const c = child.val();
                const id = child.key;
                const isFrozen = c.frozen === true;
                const card = document.createElement('div');
                card.className = 'client-card';
                card.innerHTML = `
                    <div style="display:flex; justify-content:space-between;">
                        <b>${c.name}</b>
                        <span style="color:${isFrozen ? 'red' : 'green'}">${isFrozen ? '–ë–õ–û–ö' : 'OK'}</span>
                    </div>
                    <div class="grid">
                        <div><label>–ë–∞–ª–∞–Ω—Å</label><input type="number" id="bal-${id}" value="${c.balance || 0}"></div>
                        <div><label>–ë–æ–Ω—É—Å—ã</label><input type="number" id="bon-${id}" value="${c.bonuses || 0}"></div>
                        <div><label>–ü–ò–ù</label><input type="text" id="pin-${id}" value="${c.clientPin || ''}" maxlength="4"></div>
                        <div><label>–¢—Ä–∞—Ç—ã</label><input type="number" id="spent-${id}" value="${c.spentMonth || 0}"></div>
                    </div>
                    <button class="btn-save" onclick="saveClient('${id}')">–°–û–•–†–ê–ù–ò–¢–¨</button>
                    <button class="${isFrozen ? 'btn-unblock' : 'btn-block'}" onclick="db.ref('clients').child('${id}').update({frozen: ${!isFrozen}})">
                        ${isFrozen ? '–†–ê–ó–ë–õ–û–ö–ò–†–û–í–ê–¢–¨' : '–ó–ê–ë–õ–û–ö–ò–†–û–í–ê–¢–¨'}
                    </button>
                `;
                list.appendChild(card);
            });
        });

        // --- –õ–û–ì–ò–ö–ê –†–ê–ü–û–†–¢–û–í ---
        db.ref('reports').on('value', snap => {
            const div = document.getElementById('reports-list');
            div.innerHTML = "";
            snap.forEach(child => {
                const r = child.val();
                div.innerHTML += `<div class="report-box">
                    <span style="float:right; cursor:pointer" onclick="db.ref('reports').child('${child.key}').remove()">‚úï</span>
                    <b>${r.staff}</b>: ${r.desc}
                </div>`;
            });
        });

        function saveClient(id) {
            db.ref('clients').child(id).update({
                balance: parseFloat(document.getElementById(`bal-${id}`).value) || 0,
                bonuses: parseFloat(document.getElementById(`bon-${id}`).value) || 0,
                clientPin: document.getElementById(`pin-${id}`).value,
                spentMonth: parseFloat(document.getElementById(`spent-${id}`).value) || 0
            }).then(() => alert("–û–±–Ω–æ–≤–ª–µ–Ω–æ"));
        }
    </script>
</body>
</html>
